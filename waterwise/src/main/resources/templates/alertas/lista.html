<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
  <title>Alertas</title>
</head>

<!-- Main Content -->
<div layout:fragment="content">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col">
      <h1 class="h2 text-primary">
        <i class="bi bi-exclamation-triangle me-2"></i>
        Alertas do Sistema
      </h1>
      <p class="text-muted">
        Monitoramento de condições críticas e alertas automáticos
      </p>
    </div>
    <div class="col-auto">
      <a class="btn btn-info">
        <i class="bi bi-graph-up me-1"></i>
        Dashboard Alertas
      </a>
    </div>
  </div>

  <!-- Filtros -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <form th:action="@{/admin/alertas}" method="get" class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Severidade</label>
          <select class="form-select" name="severidade">
            <option value="">Todas</option>
            <option th:each="nivel : ${niveisSeveridade}"
                    th:value="${nivel.codigoSeveridade}"
                    th:selected="${severidadeSelecionada == nivel.codigoSeveridade}"
                    th:text="${nivel.codigoSeveridade + ' - ' + nivel.descricaoSeveridade}">
              CRITICO - Nível crítico
            </option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Período</label>
          <select class="form-select" name="dias">
            <option value="">Todos</option>
            <option value="1" th:selected="${diasSelecionados == 1}">Hoje</option>
            <option value="7" th:selected="${diasSelecionados == 7}">Últimos 7 dias</option>
            <option value="30" th:selected="${diasSelecionados == 30}">Últimos 30 dias</option>
          </select>
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-funnel me-1"></i>
            Filtrar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Lista de Alertas -->
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-white border-0">
      <h5 class="card-title mb-0">
        Total: <span th:text="${#lists.size(alertas)}">0</span> alertas encontrados
      </h5>
    </div>
    <div class="card-body p-0">
      <div th:if="${!#lists.isEmpty(alertas)}">
        <div th:each="alerta : ${alertas}" class="border-bottom p-3">
          <div class="row align-items-center">
            <div class="col-auto">
                            <span th:class="'badge fs-6 bg-' + ${alerta.severidadeCss ?: 'secondary'}"
                                  th:text="${alerta.severidadeCodigo ?: 'N/A'}">CRITICO</span>
            </div>
            <div class="col">
              <h6 class="mb-1" th:text="${alerta.descricaoAlerta ?: 'Descrição não disponível'}">
                Umidade crítica do solo (28%) - capacidade de absorção severamente comprometida
              </h6>
              <div class="d-flex align-items-center text-muted small">
                <i class="bi bi-clock me-1"></i>
                <span th:text="${alerta.tempoDecorrido ?: 'Não informado'}">2 horas atrás</span>

                <span class="mx-2">•</span>

                <i class="bi bi-person me-1"></i>
                <span th:text="${alerta.produtor?.nomeCompleto ?: 'Produtor não informado'}">José Silva Santos</span>

                <span class="mx-2" th:if="${alerta.leitura?.sensor?.propriedade != null}">•</span>

                <i class="bi bi-geo-alt me-1" th:if="${alerta.leitura?.sensor?.propriedade != null}"></i>
                <span th:if="${alerta.leitura?.sensor?.propriedade != null}"
                      th:text="${alerta.leitura.sensor.propriedade.nomePropriedade}">Fazenda Esperança</span>
              </div>
            </div>
            <div class="col-auto">
              <div class="d-flex align-items-center">
                                <span th:if="${alerta.isCritico != null and alerta.isCritico()}" class="badge bg-danger me-2">
                                    <i class="bi bi-exclamation-triangle me-1"></i>
                                    URGENTE
                                </span>
                <a class="btn btn-outline-primary btn-sm">
                  Ver Detalhes
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div th:if="${#lists.isEmpty(alertas)}" class="text-center text-muted py-5">
        <i class="bi bi-shield-check display-1 d-block mb-3 opacity-25"></i>
        <h5 class="text-muted">Nenhum alerta encontrado</h5>
        <p class="mb-0">Sistema funcionando normalmente</p>
      </div>
    </div>
  </div>

  <!-- Ações Rápidas -->
  <div class="row mt-4" th:if="${!#lists.isEmpty(alertas)}">
    <div class="col-md-6">
      <div class="card border-0 bg-light">
        <div class="card-body text-center">
          <h6 class="card-title">Ações Rápidas</h6>
          <div class="d-flex flex-wrap gap-2 justify-content-center">
            <a th:href="@{/admin/alertas(severidade=CRITICO)}" class="btn btn-sm btn-danger">
              Ver Críticos
            </a>
            <a th:href="@{/admin/alertas(dias=1)}" class="btn btn-sm btn-warning">
              Alertas de Hoje
            </a>
            <a th:href="@{/admin/alertas/dashboard}" class="btn btn-sm btn-info">
              Dashboard
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card border-0 bg-light">
        <div class="card-body text-center">
          <h6 class="card-title">Estatísticas</h6>
          <!-- Estatísticas simplificadas -->
          <div class="row g-2">
            <div class="col-4">
              <div class="text-center">
                <h5 class="mb-0 text-danger" th:text="${alertas != null ? alertas.size() : 0}">0</h5>
                <small class="text-muted">Críticos</small>
              </div>
            </div>
            <div class="col-4">
              <div class="text-center">
                <h5 class="mb-0 text-warning" th:text="${alertas != null ? alertas.size() : 0}">0</h5>
                <small class="text-muted">Recentes</small>
              </div>
            </div>
            <div class="col-4">
              <div class="text-center">
                <h5 class="mb-0 text-info" th:text="${alertas != null ? alertas.size() : 0}">0</h5>
                <small class="text-muted">Total</small>
              </div>
            </div>
          </div>
          </div>
      </div>
    </div>
  </div>
</div>

</html>